<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Exam Management - Student Dashboard</title>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="../static/auth.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap');
        
        * {
            font-family: 'Inter', sans-serif;
        }
        
        body {
            background-color: #f7f9fc;
        }
        
        .sidebar-item {
            transition: all 0.2s ease;
        }
        
        .sidebar-item:hover {
            background-color: #e8f0fe;
        }
        
        .sidebar-item.active {
            background-color: #4285f4;
            color: white;
        }
        
        .table-row {
            transition: all 0.2s ease;
        }
        
        .table-row:hover {
            background-color: #f8fafb;
        }
        
        .status-badge {
            background-color: #d4f4e2;
            color: #0d9a5a;
            padding: 6px 14px;
            border-radius: 6px;
            font-size: 13px;
            font-weight: 500;
            display: inline-block;
        }
        
        .status-scheduled {
            background-color: #fff4e6;
            color: #f59e0b;
        }
        
        .status-completed {
            background-color: #e0f2fe;
            color: #0284c7;
        }
        
        .action-icon {
            width: 36px;
            height: 36px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .action-icon:hover {
            background-color: #e8f0fe;
        }
        
        .btn-primary {
            background-color: #4285f4;
            color: white;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 500;
            transition: all 0.2s ease;
        }
        
        .btn-primary:hover {
            background-color: #3367d6;
            box-shadow: 0 2px 8px rgba(66, 133, 244, 0.3);
        }
    </style>
</head>
<body>
    <div class="flex min-h-screen">
        <!-- Sidebar -->
        <aside class="w-56 bg-white border-r border-gray-200">
            <div class="p-6">
                <h1 class="text-xl font-bold text-gray-900">Exam Management</h1>
                <p class="text-sm text-gray-500 mt-1">Student Dashboard</p>
                <button class="mt-4 text-sm text-gray-600 hover:text-gray-900 flex items-center">
                    <i class="fas fa-exchange-alt mr-2 text-xs"></i>
                    Teacher
                </button>
            </div>
            
            <nav class="px-3 mt-2">
                <a href="#" class="sidebar-item active flex items-center px-4 py-3 rounded-lg mb-1">
                    <i class="fas fa-file-alt mr-3 text-sm"></i>
                    <span class="text-sm font-medium">Examinations</span>
                </a>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1">
            <div class="p-8">
                <!-- Header -->
                <div class="flex items-center justify-between mb-6">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-900">Examination List</h2>
                        <p class="text-sm text-gray-500 mt-1">Manage and monitor all examinations</p>
                    </div>
                    <button id="addExamBtn" class="btn-primary flex items-center">
                        <i class="fas fa-plus mr-2 text-sm"></i>
                        <span>Add New Exam</span>
                    </button>
                </div>
                
                <!-- Table Container -->
                <div class="bg-white rounded-lg border border-gray-200 overflow-hidden">
                    <table class="w-full">
                        <thead>
                            <tr class="bg-gray-50 border-b border-gray-200">
                                <th class="text-left py-4 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider">Title</th>
                                <th class="text-left py-4 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider">Exam ID</th>
                                <th class="text-left py-4 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider">Date</th>
                                <th class="text-left py-4 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider">Start Time</th>
                                <th class="text-left py-4 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider">End Time</th>
                                <th class="text-left py-4 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider">Duration</th>
                                <th class="text-left py-4 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider">Status</th>
                                <th class="text-center py-4 px-6 text-xs font-semibold text-gray-600 uppercase tracking-wider">Actions</th>
                            </tr>
                        </thead>
                        <tbody id="examTableBody">
                            <!-- Rows will be inserted here -->
                        </tbody>
                    </table>
                </div>
            </div>
        </main>
    </div>
    
    <!-- Add/Edit Modal -->
    <div id="examModal" class="hidden fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50">
        <div class="bg-white rounded-xl shadow-2xl w-full max-w-2xl mx-4">
            <div class="bg-gradient-to-r from-blue-500 to-blue-600 px-6 py-5 rounded-t-xl">
                <h3 class="text-xl font-semibold text-white" id="modalTitle">Add New Exam</h3>
            </div>
            
            <form id="examForm" class="p-6">
                <div class="grid grid-cols-2 gap-5">
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Exam Title</label>
                        <input type="text" id="examTitle" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Exam ID</label>
                        <input type="text" id="examId" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Date</label>
                        <input type="date" id="examDate" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Start Time</label>
                        <input type="time" id="startTime" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">End Time</label>
                        <input type="time" id="endTime" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent">
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 mb-2">Status</label>
                        <select id="examStatus" required class="w-full px-4 py-2.5 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent bg-white">
                            <option value="ongoing">Ongoing</option>
                            <option value="scheduled">Scheduled</option>
                            <option value="completed">Completed</option>
                        </select>
                    </div>
                </div>
                
                <div class="flex justify-end space-x-3 mt-6 pt-4 border-t border-gray-200">
                    <button type="button" id="cancelBtn" class="px-5 py-2.5 border border-gray-300 rounded-lg text-gray-700 font-medium hover:bg-gray-50 transition-colors">
                        Cancel
                    </button>
                    <button type="submit" class="btn-primary">
                        Save Exam
                    </button>
                </div>
            </form>
        </div>
    </div>

    <script>
        checkAccess(["teacher"]);

        $(document).ready(function() {
            let exams = [
                {
                    id: 1,
                    title: '3131',
                    examId: '3123',
                    date: '2025-11-06',
                    startTime: '01:08',
                    endTime: '12:12',
                    duration: '3213',
                    status: 'ongoing'
                },
                {
                    id: 2,
                    title: 'Mathematics Final',
                    examId: '4567',
                    date: '2025-12-15',
                    startTime: '09:00',
                    endTime: '12:00',
                    duration: '180',
                    status: 'scheduled'
                },
                {
                    id: 3,
                    title: 'Physics Midterm',
                    examId: '7890',
                    date: '2025-10-20',
                    startTime: '14:00',
                    endTime: '16:30',
                    duration: '150',
                    status: 'completed'
                }
            ];
            
            let editingId = null;
            
            function calculateDuration(start, end) {
                const startDate = new Date(`2000-01-01 ${start}`);
                const endDate = new Date(`2000-01-01 ${end}`);
                const diff = (endDate - startDate) / 60000;
                return Math.abs(diff);
            }
            
            function renderExams() {
                const tbody = $('#examTableBody');
                tbody.empty();
                
                if (exams.length === 0) {
                    tbody.append(`
                        <tr>
                            <td colspan="8" class="text-center py-12 text-gray-500">
                                <i class="fas fa-inbox text-4xl mb-3 block text-gray-300"></i>
                                <p class="text-lg font-medium">No exams found</p>
                                <p class="text-sm mt-1">Click "Add New Exam" to create one</p>
                            </td>
                        </tr>
                    `);
                    return;
                }
                
                exams.forEach(exam => {
                    let statusClass = 'status-badge';
                    if (exam.status === 'scheduled') statusClass += ' status-scheduled';
                    if (exam.status === 'completed') statusClass += ' status-completed';
                    
                    const row = $(`
                        <tr class="table-row border-b border-gray-100" data-id="${exam.id}">
                            <td class="py-4 px-6 text-sm font-medium text-gray-900">${exam.title}</td>
                            <td class="py-4 px-6 text-sm text-gray-600">${exam.examId}</td>
                            <td class="py-4 px-6 text-sm text-gray-600">${exam.date}</td>
                            <td class="py-4 px-6 text-sm text-gray-600">${exam.startTime}</td>
                            <td class="py-4 px-6 text-sm text-gray-600">${exam.endTime}</td>
                            <td class="py-4 px-6 text-sm text-gray-600">${exam.duration}</td>
                            <td class="py-4 px-6">
                                <span class="${statusClass}">${exam.status.charAt(0).toUpperCase() + exam.status.slice(1)}</span>
                            </td>
                            <td class="py-4 px-6">
                                <div class="flex items-center justify-center space-x-1">
                                    <button class="action-icon view-btn text-blue-600" data-id="${exam.id}" title="View">
                                        <i class="fas fa-eye text-sm"></i>
                                    </button>
                                </div>
                            </td>
                        </tr>
                    `);
                    tbody.append(row);
                });
            }
            
            $('#addExamBtn').on('click', function() {
                editingId = null;
                $('#modalTitle').text('Add New Exam');
                $('#examForm')[0].reset();
                $('#examModal').removeClass('hidden');
            });
            
            $('#cancelBtn').on('click', function() {
                $('#examModal').addClass('hidden');
            });
            
            $(document).on('click', '.view-btn', function() {
                const id = $(this).data('id');
                const exam = exams.find(e => e.id === id);
                if (exam) {
                    alert(`Exam Details:\n\nTitle: ${exam.title}\nID: ${exam.examId}\nDate: ${exam.date}\nTime: ${exam.startTime} - ${exam.endTime}\nDuration: ${exam.duration} min\nStatus: ${exam.status}`);
                }
            });
            
            $('#examForm').on('submit', function(e) {
                e.preventDefault();
                
                const duration = calculateDuration($('#startTime').val(), $('#endTime').val());
                
                const examData = {
                    title: $('#examTitle').val(),
                    examId: $('#examId').val(),
                    date: $('#examDate').val(),
                    startTime: $('#startTime').val(),
                    endTime: $('#endTime').val(),
                    duration: duration.toString(),
                    status: $('#examStatus').val()
                };
                
                if (editingId) {
                    const index = exams.findIndex(e => e.id === editingId);
                    if (index !== -1) {
                        exams[index] = { ...examData, id: editingId };
                    }
                } else {
                    examData.id = Date.now();
                    exams.push(examData);
                }
                
                $('#examModal').addClass('hidden');
                renderExams();
            });
            
            renderExams();
        });
    </script>
</body>
</html>